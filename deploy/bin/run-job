#!/usr/bin/env bash
set -eou pipefail

cmd="java $JAVA_OPTS -jar app.jar"
deploy_dir="usr/local/deploy/bin"

# Prereqs
case $(uname -a) in
  *arm* )
    set +e; eval "${deploy_dir}/apk"; sleep 2; apk fix || echo 'Unable to reach apk...'; set -e; ;; # set +e when apk not available
esac

case "$@" in
  backfill-* )
    # call like /usr/local/deploy/bin/run-job backfill-equities
    _job=$(echo "$@" | sed 's/backfill-//')

    eval "/usr/local/backfill/job ${_job}"
    ;;
  * )
    exec $cmd $@
    ;;
esac
